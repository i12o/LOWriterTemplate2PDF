# LOWriterTemplate2PDF

## 何をするものか

LibreOffice Writer(以後 Writer)で作成したテンプレート文書に対して、CSV
などで与えるデータを差し込み、データの1レコード毎のPDFを出力します。帳
票生成、ハガキの宛て名書きなどに使えます。

LibreOffice をサーバプロセスの様に使い、スクリプトからデータの差し込み
と出力を行なうので、バッチとしても使えます。Linux上でしか動作確認をし
ていませんが、LibreOffice、Python3、UNO が使える環境であれば動かせると
思います。

## 動作要件、依存

  - Python3
  - LibreOffice(6.1.5 で開発)
  - python3-uno
  - python3-barcode
  - python3-pyqrcode

LibreOffice や Python3、モジュールのバージョンによる依存性は調べていま
せん。多分バージョンに依存するような事はやっていないつもりです。

## 何ができるのか

テンプレート文書(Writerのテンプレートとは違います、このシステムで使う
用に作成する文書です、以後 odt)と、CSVデータを用意して、CSVデータの一
行一行の値を文書に差し込み、PDFを1ファイル、1ファイル作成します。

 - テキストの差し込み
 - 画像の差し替え
   - データの値からバーコード画像を自動生成し、差し替える
   - データの値からQRCode画像を自動生成し、差し替える
   - データの値から、事前に用意してある画像の対応するものに差し替える
 - 複数ページからなるテンプレート文書を使ったレイアウト切り替え出力
 - 完全ではありませんが、「枠」からはみ出さないよう、差し込みテキスト
   の文字サイズを変える機能が実装されています。いろいろ指定が必要です。

テキストを差し込む部分には、Writerの「フィールド」を入れておきます。フォ
ントサイズ、ボールド、下線などの装飾を、テンプレート文書を作成する段階
で「フィールド」に対して行なえます。

画像を差し替える部分は、テンプレート文書に置き換えたい画像を事前に配置
しておき、画像に「名前」(画像名)を付けておきます。出力したい大きさ、場
所に配置しておきます。「名前」に対応するデータの列を使って、上述の画像
による差し替えが行なわれます。

チェックマークのチェックあり・なし、スタンプ的な画像から選択したものを
表示するような事のための機能があります(このツールではToggleと呼びます)。
またラジオボタン的に、データの一つの値から複数のマークを連動して差し替
えるための機能もあります(同上、Selctionと呼びます)。

テンプレート文書を複数ページで作っておいて、入力データの特定列の値によっ
て指定ページのみPDFにする事ができます。配達伝票を作成する際、着払い用、
前払い用などのレイアウトをページ毎で用意しておき、差し込みデータでどの
ページをPDFにするか指定できます。一つの入力データと一つのテンプレート
文書から、データに従って複数のレイアウトどれかの帳票にする事ができます。

Writerで複雑な帳票レイアウトを作る作業に耐えられるなら、結構色々できる
んじゃないでしょうか。

## 制作動機

Linux で帳票を、バッチで作成できるようにするためです。

Writer を帳票テンプレートの作成ツール、兼レンダラーとして使うので、あ
る程度品質の良い帳票が生成できます。差し込まれるデータに対して凝った装
飾を行なえはしませんが、差し込まれるデータ毎にフォント、文字装飾などは
指定できます。

バーコードやQRCodeの生成、テンプレート文書中の画像の差し替えができるの
で、ある程度複雑な帳票の作成にも対応できます。

出力されるPDFの見た目は Writer を使って制御するので、テンプレート文書
作成者が見た目をコントロールします。差し込まれるデータは名前つきのRDB
のテーブルのようなデータであり、生成される帳票の形式にはあまり依存しま
せん。とりあえずタブ切りの CSV を読み込みますので、データ作成は様々な
方法で行なえます。帳票レイアウトを用意するのと、データ作成を別々の人が
担当できるよう、このような形になっています。

Writerで複雑なレイアウトの帳票を作成するのが(今でも)大変ではありますが、
慣れてきたらそこそこのものが作れるようになってきました。

Calc、Base と連携させて年賀状の宛名印刷をする方法をこれまでやってまし
たが、年一度しか使わないので、Baseの使い方とかCalcのデータを用意する際
の作法とか、忘れてしまうのです。ただのCSVを出せば良いだけなら、どうと
でもできますからね。

[テンプレート文書と差し込みデータの作り方](./02_writing_template_and_data.md)
